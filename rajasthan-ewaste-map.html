<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rajasthan E‑Waste Map — Single File (GeoJSON embedded)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
<style>
  html,body,#map{height:100%;margin:0}
  body{display:flex;font-family:Inter,Arial,Helvetica,sans-serif}
  #map{flex:1}
  #side{width:380px;max-width:40%;padding:18px;box-sizing:border-box;background:#fff;border-left:1px solid #eee;overflow:auto}
  .card{background:#fbfbfb;padding:10px;border-radius:8px;margin-bottom:10px;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
  .title{font-weight:700;font-size:18px;margin-bottom:6px}
  .muted{color:#666;font-size:13px}
  .search{display:flex;gap:8px;margin:10px 0}
  input[type=text]{flex:1;padding:8px;border-radius:6px;border:1px solid #ddd}
  button{padding:8px 10px;border-radius:6px;border:1px solid #ddd;background:#f6f6f6;cursor:pointer}
  pre{white-space:pre-wrap}
</style>
</head>
<body>
  <div id="map"></div>
  <div id="side">
    <div class="title">Rajasthan E‑Waste Recyclers (interactive)</div>
    <div class="muted">Click a district to view authorised recyclers. Map & dataset are bundled in this single HTML file for offline use.</div>

    <div class="search">
      <input id="districtSearch" placeholder="Search district (e.g. Jaipur)" type="text" />
      <button id="btnSearch">Go</button>
    </div>

    <div id="info"><p>Select a district on the map (or search and press Go).</p></div>

    <div class="card">
      <strong>Controls</strong>
      <div style="margin-top:8px">
        <button id="resetBtn">Reset view</button>
        <button id="downloadBtn">Download single-file HTML</button>
      </div>
      <p style="font-size:12px;margin-top:8px" class="muted">Tip: To add point markers for a recycler, include a <code>coords:[lat,lng]</code> field in that recycler's object in the <code>recyclers</code> dataset below.</p>
    </div>

    <div class="card">
      <strong>Legend (choropleth)</strong>
      <div id="legend" style="margin-top:8px" class="muted"></div>
    </div>

    <div class="card">
      <strong>About</strong>
      <p class="muted">This file includes a GeoJSON of Rajasthan districts and your recycler dataset. The script matches district names case-insensitively and tolerates common property names (e.g. DISTRICT, district, NAME_2, name).</p>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>

let map; 
let geoLayer;
const markers = L.layerGroup();

// -------------------- RECYCLERS DATA --------------------
const recyclers = {
  "JAIPUR": [
    {
      name: "M/s ETCO E-Waste Recycler Private Ltd",
      address: "SB-23, Shilp Bari, Road No. 14-15, VKI Area, Jaipur",
      activity: "Recycling & Refurbishing",
      contact: "9829018257",
      email: "etcoewaste@gmail.com",
      capacity: "4490 MTA",
      capacity_num: 4490,
      cto_validity: "30.04.2029",
      hsw_validity: "31.10.2029"
    },
    {
      name: "M/s. Urban Metals",
      address: "E-2118, Ramchandrapura RIICO Industrial Area, Sitapura, Sanganer, Jaipur",
      activity: "Dismantling and Recycling",
      contact: "9509361443",
      email: "urbanmetalsindia@gmail.com",
      capacity: "480 MTA",
      capacity_num: 480,
      cto_validity: "31.10.2025",
      hsw_validity: "30.06.2026"
    },
    {
      name: "M/s Green Web Recycling",
      address: "H1-865, Industrial Area, Manda-II, Chomu, Jaipur",
      activity: "Dismantling & Refurbishing",
      contact: "9982462926",
      email: "greenwebrecycling@gmail.com",
      capacity: "1050 MTA",
      capacity_num: 1050,
      cto_validity: "30.04.2027",
      hsw_validity: "30.04.2027"
    },
    {
      name: "M/s S.S. Enviro Care",
      address: "E 216B, Sarna Dungar Industrial Area, Jhotwara Ext., Jaipur",
      activity: "Recycling",
      contact: "9654463036",
      email: "mishank3333@gmail.com",
      capacity: "6600 MTA",
      capacity_num: 6600,
      cto_validity: "31.03.2030",
      hsw_validity: "31.03.2030"
    },
    {
      name: "M/s Shyam E Waste Recycling",
      address: "Plot No. G1-107, Manda Industrial Area, Chomu, Jaipur",
      activity: "Recycling & Refurbishing",
      contact: "8406984597",
      email: "nirmalshyam.2021@gmail.com",
      capacity: "3450 MTA",
      capacity_num: 3450,
      cto_validity: "31.05.2030",
      hsw_validity: "31.05.2030"
    },
    {
      name: "M/s Telsys Green Web Recycling Pvt. Ltd.",
      address: "E-559, RIICO Industrial Area, Manda-II, Chomu, Jaipur",
      activity: "Recycling & Refurbishing",
      contact: "9782241129",
      email: "telsysgreenweb@gmail.com",
      capacity: "13200 MTA",
      capacity_num: 13200,
      cto_validity: "30.06.2030",
      hsw_validity: "30.06.2030"
    },
    {
      name: "M/s HULLADEK PWL",
      address: "F-142, RIICO Industrial Area Bindayka, Sirsi, Jaipur",
      activity: "Recycling",
      contact: "7878940255",
      email: "hulladekpwl@gmail.com",
      capacity: "6600 MTA",
      capacity_num: 6600,
      cto_validity: "31.05.2030",
      hsw_validity: "30.06.2030"
    }
  ],

  "ALWAR": [
    {
      name: "M/s Shukla E-waste Processor",
      address: "H-309 (B), RIICO Industrial area, Bhiwadi",
      activity: "Recycling",
      contact: "8829009424",
      email: "admi@e-wasteprocessor.com",
      capacity: "680 MTA",
      capacity_num: 680,
      cto_validity: "29.02.2028",
      hsw_validity: "30.09.2024"
    },
    {
      name: "M/s Adatte E-Waste Management Pvt. Ltd.",
      address: "F-120, Industrial Area, Karoli, Tapukara Ext., Tijara, Alwar",
      activity: "Recycling & Dismantling",
      contact: "9971395011",
      email: "abhimanyu@gmail.com",
      capacity: "1780 MTA",
      capacity_num: 1780,
      cto_validity: "30.06.2028",
      hsw_validity: "28.02.2025"
    },
    {
      name: "M/s H.M. E-Waste Management",
      address: "G1-226 & G1-227, RIICO Area, Kehrani Bhiwadi Ext., Tijara, Alwar",
      activity: "Recycling & Refurbishing",
      contact: "9810286509",
      email: "anandchoudhary@hotmail.com",
      capacity: "33100 MTA",
      capacity_num: 33100,
      cto_validity: "31.06.2030",
      hsw_validity: "15.08.2026"
    },
    {
      name: "M/s Abaad Developers Private Limited",
      address: "G1-747 RIICO Industrial Area, Chopanki Bhiwadi, Tijara, Alwar",
      activity: "Recycling & Refurbishing",
      contact: "9899970888",
      email: "nnecoinfo@gmail.com",
      capacity: "700 MTA",
      capacity_num: 700,
      cto_validity: "31.12.2026",
      hsw_validity: "31.12.2026"
    },
    {
      name: "M/s Greenlet Recyclers Private Limited",
      address: "G-15-G, Sotanala Industrial Area, Behror, Alwar",
      activity: "Dismantling & Refurbishing",
      contact: "8560891100",
      email: "sushil@greenletrecycler.com",
      capacity: "1500 MTA",
      capacity_num: 1500,
      cto_validity: "31.08.2027",
      hsw_validity: "31.08.2027"
    },
    {
      name: "M/s Go Green Management LLP",
      address: "G1-612N, Khushkhera RIICO Ind. Area, Bhiwadi, Alwar",
      activity: "Recycling",
      contact: "9811977521",
      email: "pawan.kumar@gtlservices.in",
      capacity: "637 MTA",
      capacity_num: 637,
      cto_validity: "31.01.2028",
      hsw_validity: "31.01.2028"
    },
    {
      name: "M/s Greenscape Eco Management Pvt. Ltd.",
      address: "203 & 203A, MIA Alwar, Tehsil Ramgarh, Alwar",
      activity: "Dismantling & Recycling & Refurbishing",
      contact: "8290333347",
      email: "balgopal@greenscape-eco.com",
      capacity: "73494 MTA",
      capacity_num: 73494,
      cto_validity: "31.10.2029",
      hsw_validity: "31.10.2029"
    },
    {
      name: "M/s Tanwar Traders",
      address: "F-1294(E), Industrial Area, Tijara, Bhiwadi, Alwar",
      activity: "Recycling",
      contact: "9667215218",
      email: "tanwartraders2006@gmail.com",
      capacity: "300 MTA",
      capacity_num: 300,
      cto_validity: "31.08.2029",
      hsw_validity: "31.08.2029"
    },
    {
      name: "M/s Universal E-Waste Recycling Private Limited",
      address: "G1-742, RIICO Industrial Area, Chopanki, Bhiwadi, Alwar",
      activity: "Recycling & Refurbishing",
      contact: "9968683340",
      email: "universalchopanki@gmail.com",
      capacity: "6920 MTA",
      capacity_num: 6920,
      cto_validity: "31.07.2030",
      hsw_validity: "31.07.2030"
    },
    {
      name: "M/s HM Waste Management Private Ltd.",
      address: "H1-137 H, RIICO Industrial Area, Shahjahanpur, Neemrana, Alwar",
      activity: "Recycling",
      contact: "9999829677",
      email: "hmwaste22@gmail.com",
      capacity: "3300 MTA",
      capacity_num: 3300,
      cto_validity: "31.08.2030",
      hsw_validity: "31.08.2030"
    },
    {
      name: "M/s Ramdass Trading Company",
      address: "G1-177-C, MIA, Tehsil-Ramgarh, Alwar",
      activity: "Recycling",
      contact: "9352208422",
      email: "ramdastradingcompany@gmail.com",
      capacity: "180 MTA",
      capacity_num: 180,
      cto_validity: "31.12.2028",
      hsw_validity: "31.12.2028"
    }
  ],

  "SIKAR": [
    {
      name: "M/s GS International",
      address: "G1-101, Khatushyam Ji Ind. Complex, Sri Madhopur Ringus, Sikar",
      activity: "Dismantling & Refurbishing",
      contact: "9928274008",
      email: "gsinternationaljaipur@gmail.com",
      capacity: "600 MTA",
      capacity_num: 600,
      cto_validity: "28.02.2027",
      hsw_validity: "31.12.2024"
    },
    {
      name: "M/s Golden Green Recyclers",
      address: "G1-11, S.K.S. Industrial Area, Ringus, Sikar",
      activity: "Dismantling, Recycling & Refurbishing",
      contact: "9829405710",
      email: "goldengreenjpr@gmail.com",
      capacity: "750 MTA",
      capacity_num: 750,
      cto_validity: "31.03.2027",
      hsw_validity: "31.03.2027"
    }
  ],

  "BARMER": [
    {
      name: "M/s Fateh Enviro Lab",
      address: "Khasra No. 1036/14, Industrial Area, Jasol, Balotra, Barmer",
      activity: "Dismantling",
      contact: "9413880789",
      email: "aslamcetp@gmail.com",
      capacity: "350 MTA",
      capacity_num: 350,
      cto_validity: "31.12.2026",
      hsw_validity: "31.12.2026"
    }
  ],

  "CHURU": [
    {
      name: "M/s SAS Tech E-waste Recycling Solutions",
      address: "G-286, Road No 1, RIICO Industrial Area, Ratangarh, Churu",
      activity: "Recycling & Refurbishing",
      contact: "7976054127",
      email: "kirancomputech.dd@gmail.com",
      capacity: "1050 MTA",
      capacity_num: 1050,
      cto_validity: "31.12.2028",
      hsw_validity: "31.12.2028"
    }
  ],

  "DHOLPUR": [
    {
      name: "M/s The Global Metalists",
      address: "J-176, RIICO Growth Center, Dholpur",
      activity: "Dismantling & Refurbishing",
      contact: "8800869039",
      email: "global.metalist230@gmail.com",
      capacity: "604 MTA",
      capacity_num: 604,
      cto_validity: "31.03.2028",
      hsw_validity: "31.03.2028"
    },
    {
      name: "M/s Rohit Pigments Industries Pvt. Ltd.",
      address: "B-81/B, RIICO Industrial Area, Dholpur",
      activity: "Refurbishing",
      contact: "8769609584",
      email: "rohitpigment_indust@gmail.com",
      capacity: "200 MTA",
      capacity_num: 200,
      cto_validity: "30.09.2030",
      hsw_validity: "30.09.2030"
    }
  ]
};


// -------------------- GET DISTRICT NAME --------------------
function getDistrictName(feature){
  const p = feature.properties;
  return (
    p.DISTRICT || p.district || p.NAME_2 || p.NAME || 
    p.name || p.DIST_NAME || p.DIST
  )?.toString().trim() || "UNKNOWN";
}

// -------------------- CHOROPLETH CALCULATIONS --------------------
function computeDistrictTotals(){
  const totals = {};
  for(const [dist, list] of Object.entries(recyclers)){
    totals[dist.toUpperCase()] = {
      sum: list.reduce((a,b)=>a+(b.capacity_num||0),0),
      count: list.length
    };
  }
  return totals;
}
const districtTotals = computeDistrictTotals();

function getColor(d){
  return d > 20000 ? '#08306b' :
         d > 10000 ? '#08519c' :
         d > 5000  ? '#2171b5' :
         d > 2000  ? '#4292c6' :
         d > 1000  ? '#6baed6' :
         d > 500   ? '#9ecae1' :
         d > 0     ? '#c6dbef' : '#f7fbff';
}

function style(feature){
  const name = getDistrictName(feature).toUpperCase();
  const val = districtTotals[name]?.sum || 0;

  return {
    weight:1,
    color:"#444",
    fillOpacity:0.8,
    fillColor:getColor(val)
  };
}

// -------------------- LOAD GEOJSON --------------------
fetch("./rajasthan_districts.geojson")
  .then(r => r.json())
  .then(data => {
    initializeMap(data);
  })
  .catch(err => console.error("GeoJSON Load Failed:", err));


// -------------------- INITIALIZE MAP --------------------
function initializeMap(geoJSON){

  map = L.map("map").setView([26.9,75.8], 7);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom:19
  }).addTo(map);

  markers.addTo(map);

  geoLayer = L.geoJSON(geoJSON, {
    style,
    onEachFeature: (feature, layer)=>{
      const name = getDistrictName(feature).toUpperCase();

      // hover
      layer.on("mouseover", ()=> layer.setStyle({fillOpacity:1}));
      layer.on("mouseout", ()=> geoLayer.resetStyle(layer));

      // click
      layer.on("click", ()=>{
        const list = recyclers[name] || [];
        openDistrictPopup(layer, name, list);
        updateSidePanel(name, list);
        updateMarkers(list);
      });
    }
  }).addTo(map);

  map.fitBounds(geoLayer.getBounds());
}


// -------------------- POPUP --------------------
function openDistrictPopup(layer, name, list){

  let html = `<b>${name}</b><br/>`;

  if(list.length === 0){
    html += "<em>No recyclers available</em>";
  } else {
    html += `<ul style="max-height:200px;overflow:auto;padding-left:16px;">`;
    html += list.map(r=>`
      <li>
        <b>${r.name}</b><br/>
        ${r.activity||""}<br/>
        Capacity: ${r.capacity||"N/A"}
      </li>
    `).join("");
    html += "</ul>";
  }

  layer.bindPopup(html).openPopup();
}


// -------------------- SIDE PANEL --------------------
function updateSidePanel(name, list){
  const panel = document.getElementById("info");

  let html = `<h3>${name}</h3>`;

  if(list.length === 0){
    html += `<p>No recyclers available.</p>`;
  } else {
    html += list.map(r=>`
      <div style="background:#fff;padding:8px;margin-bottom:10px;border-radius:6px;">
        <strong>${r.name}</strong><br/>
        ${r.activity||""}<br/>
        Address: ${r.address||"N/A"}<br/>
        Contact: ${r.contact||"N/A"}<br/>
        Email: ${r.email||"N/A"}<br/>
        Capacity: ${r.capacity||"N/A"}
      </div>
    `).join("");
  }

  panel.innerHTML = html;
}


// -------------------- MARKERS --------------------
function updateMarkers(list){
  markers.clearLayers();

  list.forEach(r=>{
    if(r.coords){
      L.marker(r.coords)
        .addTo(markers)
        .bindPopup(r.name);
    }
  });
}


// -------------------- SEARCH --------------------
document.getElementById("btnSearch").addEventListener("click", ()=>{
  const q = document.getElementById("districtSearch").value.trim().toUpperCase();
  if(!q) return;

  let found = false;

  geoLayer.eachLayer(layer=>{
    const name = getDistrictName(layer.feature).toUpperCase();
    if(name === q){
      map.fitBounds(layer.getBounds());
      layer.fire("click");
      found = true;
    }
  });

  if(!found) alert("District not found.");
});

document.getElementById("districtSearch").addEventListener("keydown", e=>{
  if(e.key === "Enter") document.getElementById("btnSearch").click();
});


// -------------------- RESET --------------------
document.getElementById("resetBtn").addEventListener("click", ()=>{
  markers.clearLayers();
  map.fitBounds(geoLayer.getBounds());
  document.getElementById("info").innerHTML = "<p>Select a district.</p>";
});

</script>


</body>
</html>
